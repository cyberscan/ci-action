name: 'DGC CI Reporter'
description: 'Parse unit test and coverage output and display results as check and in PR thread.'
inputs:
  language:
    description: "Choose language. Currently supported: 'python', 'javascript'."
    required: true
  github-token:
    description: "Github API token."
    required: true
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v2
    - name: "Install action requirements."
      run: python3 -m pip install -r ${{ github.action_path }}/requirements.txt
      shell: bash
    - name: "Install python testing requirements."
      run: python3 -m pip install pytest coverage
      shell: bash
      if: ${{ inputs.language == 'python' }}
    - name: "Run python tests."
      run: coverage run -m pytest --junitxml junit.xml; coverage report -m > coverage.txt
      shell: bash
      if: ${{ inputs.language == 'python' }}
      continue-on-error: true
    - run: PYTHONPATH="${{ github.action_path }}" python3 -m action.action_main ${{ inputs.language }} ${{ inputs.github-token }}
      shell: bash